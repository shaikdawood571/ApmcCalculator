<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>APMC Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

<body>
  <p class="fancy-note">Now you can do billing and calculation in one place easily...!</p>
</body>

  <div class="container py-5">
    <div class="card shadow mx-auto" style="max-width: 500px;">
      <div class="card-body">
        <h4 class="text-center mb-4">APMC Calculator-Billing</h4>

        <div class="mb-3">
          <label for="totalBags" class="form-label">Total Bags</label>
          <input type="number" class="form-control" id="totalBags" placeholder="Enter total bags">
        </div>

        <div class="mb-3">
          <label for="netWeight" class="form-label">Net Weight (kg)</label>
          <input type="number" class="form-control" id="netWeight" placeholder="Enter net weight">
        </div>

        <div class="mb-3">
          <label for="price" class="form-label">Price per Bag</label>
          <input type="number" class="form-control" id="price" placeholder="Enter price per bag">
        </div>

        <div class="mb-3">
          <label for="myDropdown" class="form-label">Soot Deduction</label>
          <select class="form-select" id="myDropdown">
            <option value="">-- Select Soot --</option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="1.5">1.5</option>
            <option value="2">2</option>
            <option value="2.5">2.5</option>
            <option value="3">3</option>
            <option value="3.5">3.5</option>
            <option value="4">4</option>
            <option value="4.5">4.5</option>
            <option value="5">5</option>
          </select>
        </div>

        <div class="d-flex justify-content-between mb-4">
          <button class="btn btn-primary w-50 me-2" onclick="calculateAmount()">Submit</button>
          <button class="btn btn-secondary w-50 ms-2" onclick="clearFields()">Clear</button>
        </div>

        <div id="resultBox" class="alert alert-success d-none">
          <strong>Net Amount:</strong> ₹<span id="NetAmount">0</span>
        </div>

        <div id="customerFields" class="d-none">
          <h6 class="mt-4 border-bottom pb-2">Customer Details (Optional)</h6>

          <div class="mb-3">
            <label for="customerName" class="form-label">Customer Name</label>
            <input type="text" class="form-control" id="customerName" placeholder="Enter customer name (optional)">
          </div>

          <div class="mb-3">
            <label for="customerContact" class="form-label">Contact Number</label>
            <input type="text" class="form-control" id="customerContact" placeholder="Enter contact number (optional)">
          </div>

          <div class="mb-3">
            <label for="customerAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="customerAddress" placeholder="Enter address (optional)">
          </div>

          <div class="mb-3">
          <label for="weighBridge" class="form-label">Weigh Bridge Amount (optional)</label>
          <input type="number" class="form-control" id="weighBridge" placeholder="e.g. 100">
          </div>

          <div class="mb-3">
          <label for="laborCharges" class="form-label">Labor Charges (optional)</label>
          <input type="number" class="form-control" id="laborCharges" placeholder="e.g. 200">
          </div>

          <button class="btn btn-success w-95" onclick="generateBill()">Generate Bill</button>
        </div>

      </div>
    </div>
  </div>

  <script>
    let calculatedAmount = 0;

    function calculateAmount() {
      const bags = document.getElementById("totalBags").value.trim();
      const weight = document.getElementById("netWeight").value.trim();
      const price = document.getElementById("price").value.trim();
      const soot = document.getElementById("myDropdown").value.trim();

      if (!bags || !weight || !price || !soot) {
        alert("Please enter all product details.");
        return;
      }

      const netFinalWeight = parseFloat(weight) - (parseFloat(soot) * parseFloat(bags));
      calculatedAmount = (netFinalWeight / 75) * parseFloat(price);

      document.getElementById("NetAmount").textContent = calculatedAmount.toFixed(2);

      document.getElementById("resultBox").classList.remove("d-none");
      document.getElementById("customerFields").classList.remove("d-none");
    }

    function clearFields() {
      const fields = ["totalBags", "netWeight", "price", "myDropdown", "customerName", "customerContact", "customerAddress"];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el.tagName === "SELECT") {
          el.selectedIndex = 0;
        } else {
          el.value = "";
        }
      });

      document.getElementById("resultBox").classList.add("d-none");
      document.getElementById("customerFields").classList.add("d-none");
      document.getElementById("NetAmount").textContent = "0";
    }

    function generateBill() {
  const bags = document.getElementById("totalBags").value.trim();
  const weight = document.getElementById("netWeight").value.trim();
  const price = document.getElementById("price").value.trim();
  const soot = document.getElementById("myDropdown").value.trim();
  const name = document.getElementById("customerName").value.trim();
  const contact = document.getElementById("customerContact").value.trim();
  const address = document.getElementById("customerAddress").value.trim();
  const calculatedAmount = parseFloat(document.getElementById("NetAmount").textContent);

  const weighBridge = parseFloat(document.getElementById("weighBridge").value) || 0;
  const laborCharges = parseFloat(document.getElementById("laborCharges").value) || 0;

  if (!bags || !weight || !price || !soot) {
    alert("Please enter all product details before generating the bill.");
    return;
  }

  const finalAmount = calculatedAmount - weighBridge - laborCharges;

  // ✅ Calculate weight per bag safely
  let weightPerBag = 0;
  if (parseFloat(bags) > 0 && !isNaN(parseFloat(weight))) {
    weightPerBag = parseFloat(weight) / parseFloat(bags);
  }

  // ✅ Include weightPerBag (wpb) in the URL
  const url = `bill.html?bags=${encodeURIComponent(bags)}&weight=${encodeURIComponent(weight)}&price=${encodeURIComponent(price)}&soot=${encodeURIComponent(soot)}&amount=${encodeURIComponent(calculatedAmount.toFixed(2))}&name=${encodeURIComponent(name)}&contact=${encodeURIComponent(contact)}&address=${encodeURIComponent(address)}&weigh=${encodeURIComponent(weighBridge)}&labor=${encodeURIComponent(laborCharges)}&wpb=${encodeURIComponent(weightPerBag.toFixed(2))}&finalAmount=${encodeURIComponent(finalAmount.toFixed(2))}`;
  window.open(url, "_blank", "width=800,height=600");
}

  </script>

</body>
</html>
